<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Semester Planner</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Additional styling to ensure the summary looks like Pic 2 */
    .polaroid {
        background: white; 
        padding: 20px; 
        border-radius: 8px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-top: 30px;
        position: relative;
    }
    .summary-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
        text-align: center;
    }
    .summary-item b { display: block; font-size: 1.1rem; margin-bottom: 5px; }
    .week-list { font-size: 0.85rem; color: #666; border-top: 1px dashed #ddd; mt: 5px; pt: 5px; }
  </style>
</head>

<body>
<div class="container">

<div class="left">
    <div class="search-wrap">
      <div class="search-box">
        <input id="searchInput" placeholder="Search assignment / test / subject..." autocomplete="off" />
        <span class="icon">üîç</span>
      </div>
      <ul id="search-results"></ul>
    </div>

    <div class="semester-card">
      <h2>SEMESTER<br/>WEEK</h2>
      <div class="weeks" id="weekContainer"></div>
      <div class="days" id="daysContainer">
        <div class="day" data-day="1">Mon<div class="badge" id="b1"></div></div>
        <div class="day" data-day="2">Tue<div class="badge" id="b2"></div></div>
        <div class="day" data-day="3">Wed<div class="badge" id="b3"></div></div>
        <div class="day" data-day="4">Thu<div class="badge" id="b4"></div></div>
        <div class="day" data-day="5">Fri<div class="badge" id="b5"></div></div>
        <div class="day" data-day="6">Sat<div class="badge" id="b6"></div></div>
        <div class="day" data-day="0">Sun<div class="badge" id="b0"></div></div>
      </div>
    </div>

    <section class="polaroid">
        <h3 style="text-align:center; margin-top:0;">Overall Summary (W1‚ÄìW14)</h3>
        <div class="summary-grid">
            <div class="summary-item">
                <b>Assignments: <span id="gAssign">0</span></b>
                <div class="week-list">Week: <span id="gAssignWeek">-</span></div>
            </div>
            <div class="summary-item">
                <b>Tests/Quizzes: <span id="gTest">0</span></b>
                <div class="week-list">Week: <span id="gTestWeek">-</span></div>
            </div>
            <div class="summary-item">
                <b>Personal: <span id="gEvent">0</span></b>
                <div class="week-list">Week: <span id="gEventWeek">-</span></div>
            </div>
        </div>
    </section>
  </div>

<div class="right">
    <div class="stats">
      <div class="stat-box"><h1 id="assignCount">0</h1><p>Assignment</p></div>
      <div class="stat-box"><h1 id="testCount">0</h1><p>Test</p></div>
      <div class="stat-box"><h1 id="eventCount">0</h1><p>Event</p></div>
    </div>
    <div class="task-title">Task :</div>
    <ul id="taskList"></ul>
    <button class="add-btn" id="btnAdd">+ Add Entry</button>
  </div>
</div>

<div class="modal-back" id="modal-back">
  <div class="modal">
    <h3 id="modal-title">Add Task</h3>
    <div class="field"><label>Type</label><select id="task-type">
        <option value="assignment">Assignment</option>
        <option value="test">Test/Quiz</option>
        <option value="event">Personal Event</option>
    </select></div>
    <div class="field"><label>Title</label><input id="task-title" /></div>
    <div class="field"><label>Subject</label><input id="task-subject" /></div>
    <div class="field"><label>Week & Day</label>
        <select id="modal-week"></select>
        <select id="modal-day">
          <option value="1">Mon</option><option value="2">Tue</option>
          <option value="3">Wed</option><option value="4">Thu</option>
          <option value="5">Fri</option><option value="6">Sat</option>
          <option value="0">Sun</option>
        </select>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn ghost" id="modal-cancel">Cancel</button>
      <button class="btn" id="modal-save">Save</button>
    </div>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let selectedWeek = 1;
let selectedDay = null;

// Renders the summary at the bottom
function updateGlobalSummary() {
    let a = 0, t = 0, e = 0;
    let assignmentWeeks = [], testWeeks = [], eventWeeks = [];

    tasks.forEach(item => {
        if (item.type === "assignment") {
            a++;
            if (!assignmentWeeks.includes(item.week)) assignmentWeeks.push(item.week);
        }
        if (item.type === "test") {
            t++;
            if (!testWeeks.includes(item.week)) testWeeks.push(item.week);
        }
        if (item.type === "event") {
            e++;
            if (!eventWeeks.includes(item.week)) eventWeeks.push(item.week);
        }
    });

    document.getElementById("gAssign").textContent = a;
    document.getElementById("gTest").textContent = t;
    document.getElementById("gEvent").textContent = e;

    // Sort and display the weeks
    document.getElementById("gAssignWeek").textContent = assignmentWeeks.length ? assignmentWeeks.sort((x,y)=>x-y).join(", ") : "-";
    document.getElementById("gTestWeek").textContent = testWeeks.length ? testWeeks.sort((x,y)=>x-y).join(", ") : "-";
    document.getElementById("gEventWeek").textContent = eventWeeks.length ? eventWeeks.sort((x,y)=>x-y).join(", ") : "-";
}

// Side bar stats: counts ONLY for the currently selected week
function renderTasks() {
    const list = document.getElementById('taskList');
    list.innerHTML = '';
    
    let weekTasks = tasks.filter(t => t.week === selectedWeek);
    let counts = { assignment: 0, test: 0, event: 0 };
    
    weekTasks.forEach(t => counts[t.type]++);
    
    document.getElementById("assignCount").textContent = counts.assignment;
    document.getElementById("testCount").textContent = counts.test;
    document.getElementById("eventCount").textContent = counts.event;

    // Filter display based on day
    let display = selectedDay !== null ? weekTasks.filter(t => t.day === selectedDay) : weekTasks;
    display.forEach(t => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${t.subject}: ${t.title}</span>`;
        list.appendChild(li);
    });
}

// Helper: updates badges on the Mon-Sun boxes
function updateBadges() {
    for (let d = 0; d < 7; d++) {
        const count = tasks.filter(t => t.week === selectedWeek && t.day === d).length;
        const b = document.getElementById("b" + d);
        b.style.display = count > 0 ? "flex" : "none";
        b.textContent = count;
    }
}

// Modal and Navigation logic...
function generateWeeks() {
    const container = document.getElementById('weekContainer');
    container.innerHTML = '';
    for (let w = 1; w <= 14; w++) {
        const span = document.createElement('span');
        span.textContent = "W" + w;
        if (w === selectedWeek) span.classList.add("active");
        span.onclick = () => { selectedWeek = w; selectedDay = null; generateWeeks(); renderTasks(); updateBadges(); };
        container.appendChild(span);
    }
}

document.getElementById('modal-save').onclick = () => {
    tasks.push({
        type: document.getElementById('task-type').value,
        title: document.getElementById('task-title').value,
        subject: document.getElementById('task-subject').value,
        week: parseInt(document.getElementById('modal-week').value),
        day: parseInt(document.getElementById('modal-day').value),
        id: Date.now()
    });
    localStorage.setItem("tasks", JSON.stringify(tasks));
    document.getElementById('modal-back').style.display = 'none';
    renderTasks(); updateBadges(); updateGlobalSummary();
};

document.getElementById('btnAdd').onclick = () => {
    const mw = document.getElementById('modal-week'); mw.innerHTML = '';
    for(let i=1; i<=14; i++) mw.innerHTML += `<option value="${i}" ${i===selectedWeek?'selected':''}>W${i}</option>`;
    document.getElementById('modal-back').style.display = 'flex';
};

document.querySelectorAll('.day').forEach(d => d.onclick = () => {
    selectedDay = parseInt(d.dataset.day);
    renderTasks();
});

generateWeeks(); renderTasks(); updateBadges(); updateGlobalSummary();
</script>
</body>
</html>
